# 如何进行媒体工作流转码

本文介绍了使用媒体工作流的操作步骤及使用限制。

## 简介

可以将1个输入文件对应多个输出文件（不同分辨率、不同格式等）的流程形式，通过控制台的图形化界面，进行视频处理流程快速搭建。

## 优势

-   简单易用，视频上传完成自动触发转码任务。
-   功能强大，支持截图、转码、转封装、水印、加密、剪辑等功能。
-   在媒体工作流开始执行和完成执行时，支持向指定的消息队列或消息通知发送工作流执行信息。
-   媒体库，为您提供音视频管理功能。媒体ID关联多个格式的多个清晰度输出，使用媒体ID播放，可以实现多清晰度自动切换、多格式支持。
-   支持URL和媒体ID播放。

架构图如下所示，更多详情，请参见[工作流的开发流程](/cn.zh-CN/开发指南/工作流的开发流程.md)。

![架构](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/11373/154381864010096_zh-CN.png)

说明：

-   存储采用OSS。
-   消息通知采用MNS。
-   当上传到媒体工作流的OSS工作目录时，会自动触发工作流的执行。
-   媒体工作流执行完成时发送消息到消息队列，汇报转码结果。

## 使用限制

-   一个工作流只能配置1个输入路径，媒体工作流将处理此路径下的所有视频，上传到输入目录下的视频均会触发工作流转码。
-   工作流支持阿里云私有加密和HLS标准加密，参见[加密](/cn.zh-CN/开发指南/视频加密/加密.md)。

## 前提条件

-   准备[自定义转码模板（按需）](/cn.zh-CN/控制台指南/全局设置/转码模版.md)。
-   准备[自定义水印模板（按需）](/cn.zh-CN/控制台指南/全局设置/水印模板.md)。

## 操作步骤

1.  添加Bucket：设置媒体处理输入、输出文件的储存地址。具体操作，请参见[添加媒体Bucket](/cn.zh-CN/控制台指南/工作流管理/添加媒体Bucket.md)。
2.  创建工作流：在工作流中可以灵活配置截图、转码、转封装、水印、加密、剪辑等功能。具体操作，请参见[创建媒体工作流](/cn.zh-CN/控制台指南/工作流管理/创建工作流.md)。
3.  CDN加速域名（非必填项）：如果您需要为您的域名开启内容分发加速功能。具体操作，请参见[域名管理](/cn.zh-CN/用户指南/域名管理.md)。
4.  上传视频：您可以通过媒体处理控制台或使用OSS相关上传工具或上传SDK，上传视频文件。具体操作，请参见[上传视频](/cn.zh-CN/最佳实践/如何上传视频.md)。
5.  管理视频：通过媒体列表对媒体文件进行管理。具体操作，请参见[管理视频](/cn.zh-CN/控制台指南/媒体管理/媒体列表.md)。
6.  视频播放：可以通过播放地址或视频ID进行视频播放，具体操作，请参见[视频播放](/cn.zh-CN/开发指南/视频播放/视频播放.md)。

## 搭建一个视频转码应用服务

下载源码：[JAVA源码](https://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/attach/58040/cn_zh/1502865915040/mts-demo-java.tgz?spm=a2c4g.11186623.2.13.3d6343afYT4hd0&file=mts-demo-java.tgz)。

