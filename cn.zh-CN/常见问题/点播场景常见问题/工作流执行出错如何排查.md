工作流执行出错如何排查 
================================

视频上传后，对应的工作流执行实例失败。

背景信息
----

场景

查看方式： 登录 **媒体处理控制台** \> **媒体管理** \> **媒体库设置** \> **执行实例** ，选择具体的工作流，并单击 **查看** 。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2692510061/p166584.png)

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2692510061/p166586.png)

排查步骤

操作步骤
----

1. 

   排查输入bucket是否允许refer为空。

   查看方式：登录 **OSS控制台** ，选择bucket名称，单击 **权限管理** \> **防盗链** 。{#authority.manage}

   注意： 对应的工作流要正常执行，必须要求Bucket允许refer为空；如果不为空，设置允许为空后再次上传资源测试是否成功（如果允许refer为空，见步骤 2）。
   

2. 

   将鼠标移动到转码模块，如果报错为：The resource operated InputFile is bad

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2692510061/p166588.png)

   * ffplay（ffmpeg中的一个应用）播放对应的输入文件，查看能否正常播放，是否出现异常信息。

     
   
   * 查看MPS是否授权了OSS的权限。

     查看方式：登录 **RAM控制台** \> **角色管理** \> **角色：AliyunMTSDefaultRole** \> **角色授权策略** 。

     ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2692510061/p166589.png)
     
   

   

3. 

   如以上都正常，请提交工单，反馈以下信息：

   * 输入视频文件的URL。

     查看方式： 登录 **OSS控制台** ，选择bucket名称，单击 **文件管理** ，并单击文件名获取文件 **URL** 。

     注意：如果bucket私有，设置文件签名URL的过期时间应稍长，如10小时。
     
   
   * 对应转码失败相关信息截图。

     查看方式：登录 **媒体处理控制台** \> **媒体管理** \> **媒体库设置** \> **执行实例** ，选择具体的工作流，并单击 **查看** 。
     
   
   * 作业ID，转码模板ID，建议提供文字版ID。

     
   
   * 如果调用的是自定义转码模板，请截图自定义转码模板的配置。

     查看方式： 登录 **媒体处理控制台** \> **全局设置** \> **转码模板** ，自定义转码模板。
     
   
   * 提供角色授权策略的截图。

     查看方式： 登录 **RAM控制台** \> **角色管理** \> **角色：AliyunMTSDefaultRole** \> **角色授权策略** 。
     
   

   




执行结果
----

视频转码为m3u8失败该怎么排查？

场景

视频文件通过MPS转码为m3u8，转码失败。

排查步骤

1. 参见工作流转码任务执行出错排查步骤。

   

2. 排查工作流调用的转码模板是否是 **转封装模板** ，如 **转封装模板** 转码为m3u8，有一定的失败概率。建议使用转码模板进行转码，查看是否正常。参见 [预置模版详情](~~29256~~) 中的 **转封装模板** 。

   

3. 如以上都正常，请提交工单，反馈以下信息：

   * 输入视频文件的URL。

     查看方式：登录 **OSS控制台** ，选择bucket名称，单击 **文件管理** ，并单击文件名获取文件 **URL** 。

     注意：如果bucket私有，设置文件签名URL的过期时间应稍长，如10小时。
     
   
   * 对应转码失败相关信息截图。

     查看方式： **媒体处理控制台** \> **媒体管理** \> **媒体库设置** \> **执行实例** ，选择具体的工作流，并单击 **查看** 。
     
   
   * 作业ID，转码模板ID，建议提供文字版ID。

     
   
   * 如果调用的是自定义转码模板，请截图自定义转码模板的配置。

     查看方式：登录 **媒体处理控制台** \> **全局设置** \> **转码模板** ，自定义转码模板。
     
   
   * 提供角色授权策略的截图。

     查看方式：登录 **RAM控制台** \> **角色管理** \> **角色：AliyunMTSDefaultRole** \> **角色授权策略** 。
     
   

   




转码任务中添加水印没有效果该怎么排查？

场景

工作流配置了水印模板及对应的水印图片，但转码后对应的输出视频不存在水印。

排查步骤

1. 排查工作流调用的转码模板是否是 **转封装模板** ， **转封装模板** 转码不能添加水印。建议使用转码模板进行转码，查看是否正常。参见 [预置模板详情](~~29256~~) 中的 **转封装模板** 。

   

2. 如以上都正常，请提交工单，反馈以下信息：

   * 输入视频文件的URL。

     查看方式：登录 **OSS控制台** ，选择bucket名称，单击 **文件管理** ，并单击文件名获取文件 **URL** 。

     注意：如果bucket私有，设置文件签名URL的过期时间应稍长，如10小时。
     
   
   * 工作流转码配置截图，水印模板截图。

     
   
   * 作业ID，转码模板ID，建议提供文字版ID。

     
   
   * 如果调用的是自定义转码模板，请截图自定义转码模板的配置。

     查看方式：登录 **媒体处理控制台** \> **全局设置** \> **转码模板** ，自定义转码模板。
     
   
   * 提供角色授权策略的截图。

     查看方式：登录 **RAM控制台** \> **角色管理** \> **角色：AliyunMTSDefaultRole** \> **角色授权策略** 。
     
   

   




截图任务报错怎么处理？

场景

视频文件通过MPS工作流截图，截图失败。

排查步骤

1. 参见工作流转码任务执行出错的排查步骤。

   

2. 如果输入文件为m3u8文件，排查m3u8索引中的ts路径是否与m3u8在相同的路径下。如在不同的路径下，m3u8的同步截图不支持这种场景，会导致截图失败。

   




解决

1. 工作流配置截图任务， **截图方式** 选择 **多张截图** 。选择该方式后，便为异步截图。

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2692510061/p166592.png)
   

2. 如以上都正常，请提交工单，反馈以下信息：

   * 输入视频文件的URL。

     查看方式：登录 **OSS控制台** ，选择bucket名称，单击 **文件管理** ，并单击文件名获取文件 **URL** 。

     注意：如果bucket私有，设置文件签名URL的过期时间应稍长，如10小时。
     
   
   * 对应截图任务失败相关信息截图。

     查看方式：登录 **媒体处理控制台** \> **媒体管理** \> **媒体库设置** \> **执行实例** ，选择具体的工作流，并单击 **查看** 。
     
   
   * 作业ID，建议提供文字版ID。

     
   
   * 截图对应工作流的截图配置。

     查看方式：登录 **媒体处理控制台** \> **媒体管理** \> **媒体库设置** \> **执行实例** ，选择具体的工作流，并单击 **查看** 。

     ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2692510061/p166593.png)
     
   
   * 提供角色授权策略的截图。

     查看方式：登录 **RAM控制台** \> **角色管理** \> **角色：AliyunMTSDefaultRole** \> **角色授权策略** 。
     
   

   



