# 视频点播的媒体工作流设置

媒体工作流支持截图、转码、转封装、水印、剪辑等功能，使您可以快速、灵活、按需搭建云端音视频处理流程；在媒体工作流开始执行和完成执行时，支持向指定的消息队列或消息通知发送工作流执行信息。具体包括以下功能：输入bucket路径，转码配置，截图配置，发布配置及消息通知配置。

1.1 媒体工作流的作用

消息服务检测到输入bucket路径中存在资源增量输入，就会触发媒体工作流中的转码或者截图任务进行转码及截图，对应的任务完成，如果您的输入配置中配置了消息服务的通知或者队列即会在工作流执行实例的开始和结束时通过消息服务发送消息供用户业务逻辑判断，而对应的转码或者截图结果将存储到工作流配置的输出bucket中。

1.2 媒体工作流配置流程

用户可以登录控制台，在工作流管理中选择配置方案—\>输入设置—\>转码设置/截图设置/分析及转码设置—\>发布设置—\>配置cdn加速；

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4960867061/p198849.png)

1.3 配置方案介绍

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4960867061/p198851.png)

预置配置方案包括了：M3U8切片工作流，预置智能模板工作流，多码率多格式工作流，FLV多码率工作流，M3U8多码率工作流，MP4多码率工作流，以上工作流其实就是分析转码截图任务节点的组合，用户可以根据需求选择对应的组合或者自定义组合。

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4960867061/p198853.png)

2. 输入设置

2.1 输入设置基础设置

点击输入节点上的“铅笔”按钮—\>进入输入配置页面—\>选择输入bucket，转码管道，消息类别，填入输入路径，基础配置就完成了。

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4960867061/p198854.png)![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198856.png)

2.2 输入bucket设置

点击“选择”按钮可以进入到OSS文件管理页面，用户可以选择需求的bucket及bucket下的某个文件夹作为输入路径（文件夹选定后，会自动补全到输入路径的文本框中）。

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198858.png)

**输入bucket选择注意事项**

-   在哪个区域新建工作流，对应的输入bucket也只能是对应区域的bucket，别的区域的bucket不能选择；
-   输入bucket中的可选择bucket，必须源自媒体bucket的输入bucket，媒体bucket如何添加，请看视频点播初始化设置文档；
-   输入路径是可编辑的，但注意目录的设置不需要以/结尾，如想存储资源到1目录下的2目录，那么对应的输入路径便为1/2/，而不是1/2；
-   目前工作流只支持在华东1，华东2，华北1，华南1 区域；

2.3 转码管道设置

转码管道，是处理转码作业的管道，选择对应的管道即可。关于管道的具体意义请参见[视频点播的初始化设置](https://help.aliyun.com/knowledge_detail/50626.html?spm=5176.7842238.2.14.K0ZG68)。

**转码管道限制：**

-   目前每个用户在每个服务可用域拥有1个管道；
-   每个管道可最多可容纳10000个排队作业；
-   每个管道最多可同时处理的作业不超过分配给该管道的转码资源数；

2.4 消息类别设置

其中消息类别分为：队列和通知。消息类别可以不进行设置。队列创建看请参见[队列创建](https://help.aliyun.com/document_detail/34417.html?spm=5176.doc27414.6.558.duyoLF)； 通知创建请参见[通知创建](https://help.aliyun.com/document_detail/34424.html?spm=5176.doc34417.6.565.6S3AQ0)；队列与通知的区别请参见[队列与通知的区别](https://help.aliyun.com/document_detail/27414.html?spm=5176.doc27430.6.101.LpmYeR)；队列与通知的消息消费请参见[队列与通知的消息消费](https://help.aliyun.com/document_detail/42619.html?spm=5176.product29932.6.566.34jfpi)；选择通知后，可以选择对应的通知名称，也可以增加通知。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198860.png)选择队列后，可以选择对应的队列，也可以增加队列。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198862.png)

3. 转码设置

3.1 转码设置基础设置

点击转码按钮上的“铅笔”按钮—\>进入基础配置页面—\>选择转码模板，输出bucket，是否使用水印，填入输出路径，基础配置就完成了。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198863.png)![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198865.png)

3.2 转码模板设置

点击选择按钮—\>进入转码模板页面—\>选择转码模板。转码模板分为预置静态模板及自定义模板。视频点播的转码模板源自媒体转码MTS的转码模板，也可以在视频点播初始化设置的时候添加。预置静态模板介绍看【[预置静态模板](https://help.aliyun.com/document_detail/29256.html?spm=5176.product29194.6.606.O5zQIg)】

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198867.png)

**转码模板选择注意事项**

-   转码为不同的格式，建议选择转码模板，而不是转码封装模板，否则可能会有转码失败的可能。

3.3 输出bucket设置

点击选择按钮—\>进入OSS文件管理页面—\>选择输出bucket及对应的输出文件夹。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198869.png)

**输出bucket选择注意事项**

-   在哪个区域新建工作流，对应的输出bucket也只能是对应区域的bucket，别的区域的bucket不能选择；
-   输出bucket中的可选择bucket，必须源自媒体bucket的输出bucket，媒体bucket如何添加，请看视频点播初始化设置文档；
-   输出路径是可编辑的，但注意目录的设置不需要以/结尾，如想存储资源到1目录下的2目录，那么对应的输出路径便为1/2/，而不是1/2；
-   目前工作流只支持在华东1，华东2，华北1和华南1 四个区域；

3.4 使用水印设置

水印设置是为用户的转码视频添加水印，用户可以选择对应的水印模板或者不使用水印。水印模板选择后，选择对应的水印图片—\>进入OSS管理页面—\>选择bucket中的图片。水印模板源自媒体转码MTS的水印模板，也可以在视频点播初始化设置的时候添加。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198871.png)

**注意：**

-   水印图片所在bucket源自媒体bucket中的输出bucket。

4. 截图设置

4.1 截图设置基础设置

点击截图按钮上的“铅笔”标识—\>进入截图页面—\>选择是否进行多张截图，输出bucket，开始时间，是否设置为封面，是否截取关键帧，设置截图时间间隔，截图数量，输出路径，图片宽度，高度。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198872.png)![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198874.png)

**截图基础配置注意事项：**

-   多张截图：表示是否开启多张截图，多张截图开启后，可以设置截图数量及截图间隔；
-   开始时间，表示从什么时间点开启截图，注意设置开始时间不要大于视频总时长，不然是不会截图的；
-   设置封面：表示对应的截图是否设置为封面，如果开启多张截图，默认第一张截图设置为封面；
-   关键帧：表示是否只截取关键帧的图片，截取非关键帧的图片，图片可能会存在模糊损坏的现象；
-   图片宽度高度表示截取图片的宽高；

4.1 输出bucket设置

点击选择按钮—\>进入OSS文件管理页面—\>选择输出bucket及对应的输出文件夹。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198876.png)

**输出bucket选择注意事项**

-   在哪个区域新建工作流，对应的输出bucket也只能是对应区域的bucket，别的区域的bucket不能选择；
-   输出bucket中的可选择bucket，必须源自媒体bucket的输出bucket，媒体bucket如何添加，请看视频点播初始化设置文档；
-   输出路径是可编辑的，在选择bucket并选择文件夹后，对应的输出路径默认为：文件夹名称/ \{RunId\}/\{SnapshotTime\}/\{Count\}.jpg，\{RunId\}表示转码实例id， \{SnapshotTime\} 为截图时间点，单位为毫秒，此例中对视频第5秒截图，则变量取值为 5000，如果使用多张图片需要使用\{Count\}占位符，反之不需要；
-   目前工作流只支持在华东1，华东2，华北1和华南1 四个区域；

5. 分析/转码设置

5.1 分析/转码设置基础设置

点击转码按钮上的“铅笔”标识—\>进入基础配置页面—\>选择转码模板，输出bucket，是否使用水印，填入输出路径，基础配置就完成了。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5960867061/p198877.png)![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198878.png)

5.2 转码模板设置

点击选择按钮—\>进入转码模板页面—\>选择转码模板。转码模板为预置智能模板，对应的转码任务要生效，得转码之前的分析作业执行后，分析得到到适用该视频的转码模板包含了转码设置中选择的模板，对应的转码任务才能执行，否则是不会执行，在执行实例中出现“跳过”的图示结果。预置智能模板介绍看【[预置智能模板介绍](https://help.aliyun.com/document_detail/29256.html?spm=5176.product29194.6.606.O5zQIg)】；如果想转码任务一定执行，请直接添加转码任务，不要加分析/转码任务并且使用MTS静态模板，不要使用MTS智能模板。

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198879.png)

**转码模板选择注意事项**

-   转码为不同的格式，建议选择转码模板，而不是转码封装模板

5.3 输出bucket设置

点击选择按钮—\>进入OSS文件管理页面—\>选择输出bucket及对应的输出文件夹。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198880.png)

**输出bucket选择注意事项**

-   在哪个区域新建工作流，对应的输出bucket也只能是对应区域的bucket，别的区域的bucket不能选择；
-   输出bucket中的可选择bucket，必须源自媒体bucket的输出bucket，媒体bucket如何添加，请看视频点播初始化设置文档；
-   输出路径是可编辑的，但注意目录的设置不需要以/结尾，如想存储资源到1目录下的2目录，那么对应的输出路径便为1/2/，而不是1/2；
-   目前工作流只支持在华东1，华东2，华北1和华南1 四个区域；

5.4 使用水印设置

水印设置是为用户的转码视频添加水印，用户可以选择对应的水印模板或者不使用水印。水印模板选择后，选择对应的水印图片—\>进入OSS管理页面—\>选择bucket中的图片。水印模板源自媒体转码MTS的水印模板，也可以在视频点播初始化设置的时候添加。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198881.png)

**注意：**

-   水印图片所在bucket源自媒体bucket中的输出bucket。

6. 发布设置

点击发布边上的铅笔按钮—\>进入发布页面—\>选择媒体发布类型，基础配置就完成了。媒体发布类型分为自动及手动，默认为手动。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198882.png)![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198883.png)

**发布设置注意事项：**

-   自动与手动的区别为：自动表示工作流处理后生成的object的acl 为default状态，这个状态表示object的权限继承自bucket的权限，当bucket是公共读的时候，object的acl 也是公共读，bucket私有，object acl 也是私有的；手动表示工作流处理后生成的object的acl为私有的，必须通过鉴权才能访问该object资源；
-   已有的媒体视频要修改发布状态，可以在媒体库中点击发布，进行发布；![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198884.png)

7. 配置cdn加速

点击下一步按钮—\>进入配置内容分发网络（CDN）页面—\>如果不存在cdn域名就点击添加，快速添加点播加速域名。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198885.png)

注意：只有在新建工作流配置中有cdn 域名，对应转码输出后的资源才会带cdn域名地址的链接，如果当时创建工作流不存在CDN域名，之后在bucket中手动绑定域名并进行加速，这样的域名是不会在输出媒体地址中显示的。![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6960867061/p198886.png)

